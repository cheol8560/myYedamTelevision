<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yolo.myTv.translatePoints.service.impl.TranslatePointMapper">

	<select id="totalPoint" resultType="map">

		SELECT POINT as "point"
		,(SELECT NVL(SUM(CHARGE_POINT),0)
		FROM CHARGES
		WHERE MEMBER_ID = #{memberId}) as "totalPoint",
		(SELECT NVL(SUM(TRANSLATE_POINT),0)
		FROM TRANSLATE_POINTS
		WHERE SEND_MEMBER_ID = #{memberId}) as "sendPoint",
		(SELECT NVL(SUM(TRANSLATE_POINT),0)
		FROM TRANSLATE_POINTS
		WHERE RECEIVE_MEMBER_ID = #{memberId}) as "receivePoint"
		FROM MEMBERS
		WHERE MEMBER_ID = #{memberId}

	</select>
	
	<select id="accumulatePoint" resultType="map">
	SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
	SELECT POINT as "point"
		,(SELECT NVL(SUM(REQUEST_POINT),0)
		FROM EXCHANGES
		WHERE MEMBER_ID = #{memberId}) as "accumulatePoint",
		(SELECT NVL(SUM(TRANSLATE_POINT),0)
		FROM TRANSLATE_POINTS
		WHERE SEND_MEMBER_ID = #{memberId}) as "sendPoint",
		(SELECT NVL(SUM(TRANSLATE_POINT),0)
		FROM TRANSLATE_POINTS
		WHERE RECEIVE_MEMBER_ID = #{memberId}) as "receivePoint"
		FROM MEMBERS
		WHERE MEMBER_ID = #{memberId}
			<![CDATA[					
	) A WHERE ROWNUM <= #{lastIndex}
)WHERE RNUM > #{firstIndex}
]]>
	</select> 
	
	<select id="accumulatePointCount" resultType="int">
	SELECT COUNT(*)
		FROM MEMBERS
		WHERE MEMBER_ID = #{memberId}
	</select> 
	
	<resultMap type="translate" id="translateMap"> 
		<result property="translateId" column="TRANSLATE_ID" />
		<result property="translatePoint" column="TRANSLATE_POINT" />
		<result property="sendMemberId" column="MEMBER_ID" />
		<result property="receiveMemberId" column="MEMBER_ID" />
		<result property="translateDate" column="TRANSLATE_DATE" />
		<result property="totalPoint" column="TOTAL_POINT" />
		<result property="sendPoint" column="SEND_POINT" />
		<result property="receivePoint" column="RECEIVE_POINT" />
		<result property="point" column="POINT" />
	</resultMap>


	<select id="getTranslatePointList" resultType="map">
		SELECT
		TRANSLATE_ID      		"translateId",
		TRANSLATE_POINT 		"translatePoint",
		SEND_MEMBER_ID 			"sendMemberId",
		RECEIVE_MEMBER_ID		"receiveMemberId",
		TRANSLATE_DATE			"translateDate"
		FROM TRANSLATE_POINTS
	</select>
	 
	<select id="resultInsertTrans" resultType="map">
		SELECT
		TRANSLATE_ID			"translateId"   		
		,TRANSLATE_POINT 		"translatePoint"
		,SEND_MEMBER_ID 		"sendMemberId"	
		,RECEIVE_MEMBER_ID		"receiveMemberId"
		,TRANSLATE_DATE			"translateDate"
		,(SELECT POINT FROM MEMBERS WHERE MEMBER_ID = A.SEND_MEMBER_ID) "point"
		FROM TRANSLATE_POINTS A
		WHERE TRANSLATE_ID = #{translateId}
	</select>

	<update id="updateTranslatePoint" parameterType="translate">
		UPDATE
		TRANSLATE_POINTS
		SET TRANSLATE_ID = #{translateId},
		TRANSLATE_POINT = #{translatePoint},
		SEND_MEMBER_ID = #{sendMemberId},
		RECEIVE_MEMBER_ID = #{receiveMemberId},
		TRANSLATE_DATE = #{translateDate}
		WHERE TRANSLATE_ID = #{translateId}
	</update>

	<delete id="deleteTranslatePoint" parameterType="int">
		DELETE FROM
		TRANSLATE_POINTS
		WHERE TRANSLATE_ID= #{translateId}
	</delete>

	<insert id="insertTrans" statementType="CALLABLE"	parameterType="transVO">
		{ call TRANS(
		#{inTranslatePoint},
		#{inSendMemberId},
		#{inReceiveMemberId},
		#{outErrorcode, mode=OUT, jdbcType=NUMERIC, javaType=int},
		#{outMessage, mode=OUT, jdbcType=VARCHAR, javaType=string})
		}
	</insert>
	
	<select id="PresentedPointList" resultType="map">
		SELECT
		TRANSLATE_DATE			"translateDate"
		,SEND_MEMBER_ID 		"sendMemberId"	
		,TRANSLATE_POINT 		"translatePoint"
		FROM TRANSLATE_POINTS
		WHERE RECEIVE_MEMBER_ID = #{memberId} 
	</select>
	
</mapper>
